<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    {% load static %}

    <link rel="stylesheet" href="{% static 'css/handbook_info.css' %}">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400&display=swap" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <title>Document</title>
</head>
<body>

    <nav class="navbar">
        <div>

            <div class="navbar-brand">
                <a href="/" class="navbar-brand-name">
                    <img src="/media/navbar/logo.png" width="40" height="40" class="logo">VOI
                </a>
            </div>
        </div>
        
        <div class="navbar-search">
            <input type="text" id="searchInput" placeholder="Search" class="navbar-search-input">
            <button class="navbar-search-button" id="navbarSearchButton">
            </button>
        </div>
        
        <button class="toggle-button">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>

        <div class="navbar-links">
            <ul>
                <li>
                    <a class="games" id="games" href="{% url 'games_view:all_games' %}">Games</a>
                </li>
                <li id="loginLi">
                    <a class="login" id="login" href="{% url 'user_view:login' %}">Log in</a>
                </li>
                <li id="registerLi">
                    <a class="register" id="register" href="{% url 'user_view:register' %}">Register</a>
                </li>
                <li>
                    <a class="profile" id="profile" href="{% url 'user_view:profile' %}">Profile</a>
                </li>
            </ul>            
        </div>
    </nav>

    <div id="handbook">
        <div id="author"></div>
        <div id="title"></div>
        <div id="body"></div>
        <div id="handbookScreenshot">
        </div>
    </div>
</body>
<script>

$(".toggle-button").click(function(){
    $(".navbar-links").toggleClass('active');
    $(".navbar-search").toggleClass('active');
});

$("#navbarSearchButton").click(function(){
    searchInput = $("#searchInput").val();
    top.location.href = `/games/search/?name=${searchInput}`;
});

$(".profile").css("display", "none");

let token = localStorage.getItem("token");

if (token){
    $("#loginLi").empty();
    $("#registerLi").empty();
    $("#profile").css("display", "block");
}

    handbookId = window.location.href.split("/")[4]
    $.ajax({
        method: "GET",
        url: `/api/v1/handbook/${handbookId}`,
        success: function(result){
            var handbook = result["handbook"];
            console.log(handbook)
            var author = result["handbook"]["author"]["profile"]["username"];
            var title = handbook["title"];
            var body = handbook["body"];
            var screenshot = handbook["screenshot"];
            if (screenshot){
                $.each(screenshot, function(index){
                    var file_url = screenshot[index]["file_url"]
                    $("#handbookScreenshot").append(
                        `<img class='screenshot' src='/media/${file_url}' id='screenshot_${index}'>`
                    );
                    $(`#screenshot_${index}`).click(function(){
                        window.open(`/media/${file_url}`)
                    });
                });
            }
            $("#author").append(author);
            $("#title").append(title);
            $("#body").append(marked.parse(body));
        }
    })
</script>
</html>